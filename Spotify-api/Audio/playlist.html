<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Playlist - Spotify</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
body{background:#121212;color:#fff;font-family:'Montserrat',sans-serif;margin:0;padding:0;display:flex;flex-direction:column;min-height:100vh;}
header{background:#000;padding:15px 30px;display:flex;justify-content:space-between;align-items:center;}
header h1{color:#1DB954;font-size:28px;font-weight:900;}
header a{color:#1DB954;text-decoration:none;border:2px solid #1DB954;padding:6px 12px;border-radius:20px;}
main{flex:1;padding:40px;display:flex;flex-direction:column;align-items:center;}
.logo{width:120px;margin-bottom:30px;}
.section-title{text-align:center;font-size:28px;font-weight:700;margin:20px 0;}
.search-box{width:300px;margin-bottom:30px;}
.search-box input{width:100%;padding:12px 15px;border-radius:25px;border:none;outline:none;font-size:14px;background:#1e1e1e;color:#fff;transition:all 0.3s;}
.search-box input::placeholder{color:#aaa;}
.search-box input:focus{background:#1DB954;color:#000;}
/* Playlist Musicas */
.playlist-music-grid,.available-music-grid{display:flex;flex-direction:column;gap:12px;width:100%;max-width:700px;}
.music-card{display:flex;background:#181818;border-radius:12px;overflow:hidden;cursor:pointer;transition:all 0.3s;}
.music-card:hover{transform:scale(1.02);box-shadow:0 10px 20px rgba(29,185,84,0.6);}
.music-image{width:120px;height:120px;object-fit:cover;}
.music-info{flex:1;padding:10px 15px;display:flex;flex-direction:column;justify-content:center;}
.music-name{font-size:18px;font-weight:700;color:#fff;margin-bottom:5px;}
.music-artist{font-size:14px;color:#aaa;}
.music-actions{display:flex;gap:12px;margin-top:10px;}
.music-actions button{background:transparent;border:none;color:#1DB954;font-size:18px;cursor:pointer;transition:all 0.2s;}
.music-actions button:hover{color:#fff;}
/* Footer */
footer{height:35px;background:#1db954;color:#000;font-weight:700;display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 -2px 10px rgba(29,185,84,0.8);}
</style>
</head>
<body>
<header>
<h1>Spotify</h1>
<a href="biblioteca.html"><i class="fa-solid fa-arrow-left"></i> Sua Biblioteca</a>
</header>

<main>
<img src="https://upload.wikimedia.org/wikipedia/commons/1/19/Spotify_logo_without_text.svg" class="logo" alt="Spotify Logo">

<!-- Nome da Playlist -->
<h2 class="section-title" id="playlistTitle">Minha Playlist</h2>

<!-- Pesquisa -->
<div class="search-box">
<input type="text" id="searchInput" placeholder="Buscar música...">
</div>

<!-- Musicas já na playlist -->
<h2 class="section-title">Músicas na Playlist</h2>
<div class="playlist-music-grid" id="playlistMusicGrid"></div>

<!-- Musicas disponíveis para adicionar -->
<h2 class="section-title">Adicionar Música</h2>
<div class="available-music-grid" id="availableMusicGrid"></div>
</main>

<footer>By Laisa & Belle - 2025</footer>

<script>
const playlistName = localStorage.getItem("currentPlaylist") || "Minha Playlist";
document.getElementById("playlistTitle").textContent = playlistName;

let playlistMusics = JSON.parse(localStorage.getItem(playlistName) || "[]");
const playlistMusicGrid = document.getElementById("playlistMusicGrid");
const availableMusicGrid = document.getElementById("availableMusicGrid");
const searchInput = document.getElementById("searchInput");
let allMusics = [];

// Função para tocar música
function tocarMusica(musica){
  const audio = new Audio(musica.audio); 
  audio.play();
}

// Renderiza músicas na playlist
function renderPlaylistMusics(){
  playlistMusicGrid.innerHTML = "";
  if(playlistMusics.length===0){
    playlistMusicGrid.innerHTML = '<p style="color:#aaa;">Nenhuma música na playlist</p>';
    return;
  }
  playlistMusics.forEach(musica=>{
    const card = document.createElement("div");
    card.className="music-card";

    const img = document.createElement("img");
    img.className="music-image";
    img.src=musica.capa;
    img.alt=musica.titulo;

    const info = document.createElement("div");
    info.className="music-info";

    const name = document.createElement("div");
    name.className="music-name";
    name.textContent=musica.titulo;

    const artist = document.createElement("div");
    artist.className="music-artist";
    artist.textContent=musica.artista;

    const actions = document.createElement("div");
    actions.className="music-actions";

    const btnRemove = document.createElement("button");
    btnRemove.innerHTML='<i class="fa-solid fa-xmark"></i>';
    btnRemove.title="Remover da playlist";
    btnRemove.addEventListener("click",(e)=>{
      e.stopPropagation();
      playlistMusics = playlistMusics.filter(m=>m.id!==musica.id);
      localStorage.setItem(playlistName, JSON.stringify(playlistMusics));
      renderPlaylistMusics();
      renderAvailableMusics(allMusics);
    });

    actions.appendChild(btnRemove);
    info.appendChild(name);
    info.appendChild(artist);
    info.appendChild(actions);

    card.appendChild(img);
    card.appendChild(info);

    card.addEventListener("click",()=>tocarMusica(musica));

    playlistMusicGrid.appendChild(card);
  });
}

// Renderiza músicas disponíveis para adicionar
function renderAvailableMusics(musicas){
  availableMusicGrid.innerHTML="";
  if(musicas.length===0){
    availableMusicGrid.innerHTML='<p style="color:#aaa;">Nenhuma música disponível</p>';
    return;
  }
  musicsToShow = musicas.filter(m=>{
    return !playlistMusics.find(pm=>pm.id===m.id);
  });
  musicsToShow.forEach(musica=>{
    const card = document.createElement("div");
    card.className="music-card";

    const img = document.createElement("img");
    img.className="music-image";
    img.src=musica.capa;
    img.alt=musica.titulo;

    const info = document.createElement("div");
    info.className="music-info";

    const name = document.createElement("div");
    name.className="music-name";
    name.textContent=musica.titulo;

    const artist = document.createElement("div");
    artist.className="music-artist";
    artist.textContent=musica.artista;

    const actions = document.createElement("div");
    actions.className="music-actions";

    const btnAdd = document.createElement("button");
    btnAdd.innerHTML='<i class="fa-solid fa-plus"></i>';
    btnAdd.title="Adicionar à playlist";
    btnAdd.addEventListener("click",(e)=>{
      e.stopPropagation();
      // Verifica se já existe antes de adicionar
      if(!playlistMusics.find(m=>m.id===musica.id)){
        playlistMusics.push(musica);
        localStorage.setItem(playlistName, JSON.stringify(playlistMusics));
        renderPlaylistMusics();
        renderAvailableMusics(allMusics);
      }
    });

    actions.appendChild(btnAdd);
    info.appendChild(name);
    info.appendChild(artist);
    info.appendChild(actions);

    card.appendChild(img);
    card.appendChild(info);

    card.addEventListener("click",()=>tocarMusica(musica));

    availableMusicGrid.appendChild(card);
  });
}

// Buscar músicas
searchInput.addEventListener("input",()=>{
  const termo = searchInput.value.trim().toLowerCase();
  const filtradas = allMusics.filter(m=>m.titulo.toLowerCase().includes(termo) || m.artista.toLowerCase().includes(termo));
  renderAvailableMusics(filtradas);
});

// Carregar músicas do backend
async function carregarMusicas(){
  try{
    const res = await fetch("http://localhost:5115/api/Musica/ListSongs"); 
    if(!res.ok) throw new Error("Erro ao carregar músicas");
    allMusics = await res.json();
    renderAvailableMusics(allMusics);
    renderPlaylistMusics();
  }catch(e){
    availableMusicGrid.innerHTML='<p style="color:red;">'+e.message+'</p>';
  }
}

carregarMusicas();
</script>
</body>
</html>
