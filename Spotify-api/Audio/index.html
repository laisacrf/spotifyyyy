<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Spoty - Laisa & Belle</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background: #121212;
  color: #fff;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 200px;
  background: #000;
  padding: 25px 20px;
  display: flex;
  flex-direction: column;
  gap: 25px;
  border-radius: 0 20px 20px 0;
  box-shadow: 4px 0 20px rgba(0,0,0,0.6);
  position: fixed;
  height: 100vh;
  z-index: 1000; /* Adicionado */
}

.main {
  margin-left: 240px;
  flex: 1;
  padding: 25px 50px 220px 50px; /* top, right, bottom, left */
}

.section-title {
  padding-left: 10px; /* novo */
}

.sidebar-header { display: flex; align-items: center; gap: 12px; }
.sidebar-header img { width: 36px; height: 36px; }
.sidebar-header h2 { font-size: 22px; color: #1db954; font-weight: 700; }
.nav-links { display: flex; flex-direction: column; gap: 12px; margin-top: 30px;}
.nav-links .btn {
  display: flex; align-items: center; gap: 12px;
  font-size: 15px; color: #b3b3b3; padding: 12px 15px;
  border-radius: 8px; font-weight: 600; text-decoration: none;
  transition: all 0.3s;
}
.nav-links .btn:hover,
.nav-links .btn.active { background: rgba(29,185,84,0.2); color:#fff; transform: translateX(6px); }
.section-title {
  font-size: 36px; font-weight: 800; margin: 25px 0;
  color: #fff; letter-spacing: 1px;
  text-shadow: 0 0 10px rgba(29,185,84,0.6);
}

/* Grid artistas */
.grid-artists {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 30px;
  justify-items: center;
  width: calc(100% - 30px);
  margin-bottom: 50px;
}
.artist-card {
  text-align: center;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}
.artist-card:hover { transform: scale(1.08); box-shadow: 0 12px 25px rgba(29,185,84,0.6); }
.artist-image { width: 180px; height: 180px; border-radius: 50%; object-fit: cover; margin-bottom: 12px; }
.artist-name { font-weight: 700; font-size: 18px; color: #fff; text-align: center; }

/* Grid músicas */
.grid-musics {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 25px;
  justify-items: center;
  width: calc(100% - 30px);
  margin-bottom: 50px;
}
.music-card {
  background: #181818;
  border-radius: 15px;
  padding: 15px;
  width: 220px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}
.music-card:hover { transform: scale(1.05); box-shadow: 0 12px 25px rgba(29,185,84,0.6); }
.music-image { width: 100%; height: 220px; border-radius: 12px; object-fit: cover; margin-bottom: 12px; }
.music-name { font-size: 17px; font-weight: 700; color: #fff; margin-bottom: 12px; text-shadow: 0 0 5px rgba(0,255,0,0.3);}
.music-actions { display: flex; justify-content: center; gap: 20px; }
.music-actions button {
  background: none; border: none; color: #b3b3b3; font-size: 24px; cursor: pointer; transition: all 0.3s;
}
.music-actions button.active { color: #1DB954; transform: scale(1.3); }

/* Player fixo - moderno e clean */
#player {
  position: fixed; bottom: 0; left: 240px; right: 0;
  background: #181818; padding: 20px 30px;
  display: flex; align-items: center; gap: 20px;
  box-shadow: 0 -6px 25px rgba(0,0,0,0.8); display: none; z-index: 10;
  border-top: 1px solid #282828;
  border-radius: 12px 12px 0 0;
}
#player img { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; }
#playerInfo { flex: 1; font-size: 18px; font-weight: 700; }
#playerControls { display: flex; gap: 20px; align-items: center; }
#playerControls button {
  background: none; border: none; font-size: 28px; cursor: pointer;
  color: #b3b3b3; transition: all 0.3s;
}
#playerControls button:hover { color: #1DB954; transform: scale(1.2); }

/* Barra de progresso clean */
#progressContainer {
  flex: 2; height: 6px; background: #282828;
  border-radius: 8px; cursor: pointer; position: relative;
  overflow: hidden;
  margin-left: 20px;
}
#progressBar {
  height: 100%;
  background: linear-gradient(90deg,#1DB954,#00FFAA);
  width: 0%; border-radius: 8px;
  transition: width 0.2s;
}

/* Footer */
footer {
  text-align: center; padding: 10px 0;
  font-size: 14px; color: #b3b3b3;
  border-top: 1px solid #282828;
  margin-top: auto;
}
</style>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Spotify_icon.svg" alt="Logo">
    <h2>Spotify</h2>
  </div>
  <div class="nav-links">
    <button class="btn active"><i class="fa-solid fa-house"></i> Início</button>
    <a href="biblioteca.html" class="btn"><i class="fa-solid fa-book"></i> Sua Biblioteca</a>
  </div>
</div>

<div class="main">
  <h2 class="section-title">Artistas</h2>
  <div id="artistsGrid" class="grid-artists"></div>

  <h2 class="section-title">Músicas</h2>
  <div id="musicGrid" class="grid-musics"></div>
</div>

<div id="player">
  <img id="playerImage" src="" alt="">
  <div id="playerInfo"></div>
  <div id="playerControls">
    <button id="likeBtn"><i class="fa-regular fa-heart"></i></button>
    <button id="playPauseBtn"><i class="fa-solid fa-circle-play"></i></button>
  </div>
  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>
  <audio id="audioPlayer"></audio>
</div>

<footer>Laisa & Belle - 2025</footer>

<script>
const backendPort = 5115;
const urls = {
  urlListar: `http://localhost:${backendPort}/api/Musica/ListSongs`,
  urlBuscarPorArtista: a => `http://localhost:${backendPort}/api/Musica/GetMusicByArtist/${encodeURIComponent(a)}`,
  urlTocar: id => `http://localhost:${backendPort}/api/Musica/PlayMusic/${id}`,
  urlCapa: id => `http://localhost:${backendPort}/api/Musica/GetCover/${id}`,
  urlListarArtistas: `http://localhost:${backendPort}/api/Musica/ListArtists`,
  urlFotoArtista: id => `http://localhost:${backendPort}/api/Musica/GetPhoto/${id}`
};

const artistsGrid = document.getElementById("artistsGrid");
const musicGrid = document.getElementById("musicGrid");
const player = document.getElementById("player");
const audioPlayer = document.getElementById("audioPlayer");
const playerImage = document.getElementById("playerImage");
const playerInfo = document.getElementById("playerInfo");
const playPauseBtn = document.getElementById("playPauseBtn");
const likeBtn = document.getElementById("likeBtn");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.getElementById("progressContainer");

let allArtists = [], allMusics = [], currentMusic = null;

async function carregarArtistas(){
  const res = await fetch(urls.urlListarArtistas);
  allArtists = await res.json();
  renderArtists(allArtists);
}

function renderArtists(artists){
  artistsGrid.innerHTML="";
  artists.forEach(a=>{
    const card = document.createElement("div");
    card.className="artist-card";
    const img = document.createElement("img");
    img.className="artist-image";
    img.src=urls.urlFotoArtista(a.id);
    img.alt=a.nome;
    const name = document.createElement("div");
    name.className="artist-name";
    name.textContent=a.nome;
    card.appendChild(img);
    card.appendChild(name);
    card.addEventListener("click",()=>filtrarPorArtista(a.nome));
    artistsGrid.appendChild(card);
  });
}

async function carregarMusicas(){
  const res=await fetch(urls.urlListar);
  allMusics=await res.json();
  renderMusics(allMusics);
}

function renderMusics(musicas){
  musicGrid.innerHTML="";
  musicas.forEach(m=>{
    const card = document.createElement("div");
    card.className="music-card";
    const img = document.createElement("img");
    img.className="music-image";
    img.src=urls.urlCapa(m.id);
    img.alt=m.titulo;
    const name = document.createElement("div");
    name.className="music-name";
    name.textContent=m.titulo;
    const actions = document.createElement("div");
    actions.className="music-actions";
    const btnLike = document.createElement("button");
    btnLike.innerHTML='<i class="fa-regular fa-heart"></i>';
    btnLike.addEventListener("click", e=>{
      e.stopPropagation();
      toggleLike(m, btnLike);
    });
    actions.appendChild(btnLike);
    card.appendChild(img);
    card.appendChild(name);
    card.appendChild(actions);
    card.addEventListener("click",()=>tocarMusica(m));
    musicGrid.appendChild(card);
  });
}

function toggleLike(musica, btn){
  let curtidas=JSON.parse(localStorage.getItem("curtidas")||"[]");
  const idx=curtidas.findIndex(x=>x.id==musica.id);
  if(idx===-1) curtidas.push({id:musica.id,titulo:musica.titulo,artista:musica.artista});
  else curtidas.splice(idx,1);
  localStorage.setItem("curtidas",JSON.stringify(curtidas));
  atualizarIconeLikeById(btn,musica.id);
}

function atualizarIconeLikeById(btn,musicaId){
  const icon=btn.querySelector("i");
  const curtidas=JSON.parse(localStorage.getItem("curtidas")||"[]");
  const curtiu=curtidas.some(m=>m.id==musicaId);
  if(curtiu){icon.classList.replace("fa-regular","fa-solid");icon.style.color="#1DB954";}
  else{icon.classList.replace("fa-solid","fa-regular");icon.style.color="#b3b3b3";}
}

function tocarMusica(m){
  currentMusic=m;
  player.style.display="flex";
  playerImage.src=urls.urlCapa(m.id);
  playerInfo.textContent=`${m.titulo} - ${m.artista}`;
  audioPlayer.src=urls.urlTocar(m.id);
  audioPlayer.play();
  playPauseBtn.innerHTML='<i class="fa-solid fa-circle-pause"></i>';
  atualizarIconeLikeById(likeBtn,m.id);
}

likeBtn.addEventListener("click",()=>{if(currentMusic) toggleLike(currentMusic,likeBtn);});
playPauseBtn.addEventListener("click",()=>{
  if(!currentMusic) return;
  if(audioPlayer.paused){audioPlayer.play();playPauseBtn.innerHTML='<i class="fa-solid fa-circle-pause"></i>';}
  else{audioPlayer.pause();playPauseBtn.innerHTML='<i class="fa-solid fa-circle-play"></i>';}
});

audioPlayer.addEventListener('timeupdate', () => {
  const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
  progressBar.style.width = percent + '%';
});
progressContainer.addEventListener('click', e => {
  const rect = progressContainer.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const percent = x / rect.width;
  audioPlayer.currentTime = percent * audioPlayer.duration;
});

async function filtrarPorArtista(nome){
  const res=await fetch(urls.urlBuscarPorArtista(nome));
  const musics=await res.json();
  renderMusics(musics);
}



async function iniciar(){ await carregarArtistas(); await carregarMusicas(); }
iniciar();
</script>
</body>
</html>
